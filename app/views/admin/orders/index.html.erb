<div class="card">
  <div class="card-header">
    Listing Orders
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-9">
        <div class="row">
          <div class="col-auto mr-auto">
            <%= paginate @orders %>
          </div>
        </div>
        <table class="table table-bordered table-hover">
          <thead>
            <tr class="table-secondary">
              <th class="align-middle text-center"><%= sort_link(@q, :status) %></th>
              <th class="align-middle text-center"><%= sort_link(@q, :created_at, 'Trans. Date') %></th>
              <th class="align-middle text-center">Request ID / Transaction ID</th>
              <th class="align-middle text-center">User</th>
              <th class="align-middle text-center">Total Price</th>
            </tr>
          </thead>
          <tbody>
            <% @orders.each do |order| %>
              <tr>
                <td class="align-middle text-center">
                  <% if order.status && (order.status.upcase == 'COMPLETED' || order.status.upcase == 'GIFT') %>
                    <span class="text-success">
                  <% else %>
                    <span class="text-danger">
                  <% end %>
                    <%= order.status %>
                  </span>
                </td>
                <td class="align-middle text-center">
                  <%= order.created_at.to_fs(:date_time12) %>
                </td>
                <td class="align-middle text-center" style="font-size: 75%;">
                  <%= link_to order.request_id.truncate(25), admin_order_path(order) %>
                  <br />
                  <%= link_to order.transaction_id.truncate(25), admin_order_path(order) %>
                </td>
                <td class="align-middle text-center">
                  <%= order.user.email %>
                </td>
                <td class="align-middle text-center">
                  <%= number_to_currency(order.total_price) %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <%= paginate @orders %>
      </div>
      <div class="col-3">
        <div class="card">
          <div class="card-header">
            Search
          </div>
          <div class="card-body">
            <%= search_form_for(@q, url: 'orders') do |f| %>
              <div class="form-row pb-3">
                <%= f.label :created_at_month_datepart_equals, 'Transaction Month/Year', class: 'pl-1' %>
                <div class="col">
                  <%= f.select :created_at_month_datepart_equals, [['Jan', 1],['Feb', 2],['Mar', 3],['Apr',4],['May',5],['Jun',6],['Jul',7],['Aug',8],['Sep',9],['Oct',10],['Nov',11],['Dec',12]], { include_blank: true }, class: 'form-control' %>
                </div>
                <div class="col">
                  <%= f.select :created_at_year_datepart_equals, (Date.today.year).downto(2010), { include_blank: true }, class: 'form-control' %>
                </div>
              </div>
              <div class="form-group">
                <%= f.label :status_eq %>
                <%= f.select :status_eq, ['COMPLETED', 'Completed', 'INVALID', 'Failed', 'GIFT'], { include_blank: true }, class: 'form-control' %>
              </div>
              <p>
                Trans ID vs Req ID
                <a
                  tabindex="0"
                  role="button"
                  class="btn-lg text-blue"
                  data-toggle="popover"
                  data-trigger="focus"
                  data-placement="left"
                  title="Transaction ID vs Request ID"
                  data-html="true"
                  data-content='<%= image_tag('paypal_screen.png', size: '500') %>'>
                  <i class="fa fa-question-circle"></i>
                </a>
              </p>
              <div class="form-group">
                <%= f.label :transaction_id_eq, 'Transaction ID' %>
                <%= f.search_field :transaction_id_eq, class: "form-control" %>
              </div>
              <div class="form-group">
                <%= f.label :request_id_eq, 'Request ID' %>
                <%= f.search_field :request_id_eq, class: "form-control" %>
              </div>
              <div class="form-group">
                <%= f.label :belongs_to_user_in, 'User Email' %>
                <%= f.search_field :belongs_to_user_in, class: "form-control" %>
              </div>
              <br />
              <%= f.submit 'Search', class: 'btn btn-primary btn-block mb-1' %>
              <%= link_to "Clear Search", request.path, class:"btn btn-warning btn-block" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
